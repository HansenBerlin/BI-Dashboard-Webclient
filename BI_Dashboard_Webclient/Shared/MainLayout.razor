@inherits LayoutComponentBase
@using BI_Dashboard_Webclient.Components

<MudThemeProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
    <MudAppBar Color="Color.Primary" Fixed="false" Dense="true">
        <MudMenu 
            Style="width: 200px;" 
            FullWidth="@true" 
            ActivationEvent="@MouseEvent.MouseOver" 
            AnchorOrigin="Origin.BottomCenter" 
            TransformOrigin="Origin.TopCenter">
            <ActivatorContent>
                <MudIconButton 
                    Icon="@Icons.Material.Filled.Menu" 
                    Color="Color.Inherit" 
                    Size="Size.Medium" 
                    Edge="Edge.Start"/>
            </ActivatorContent>
            <ChildContent>
                <NavMenu/>
            </ChildContent>
        </MudMenu>
        <MudSpacer/>
        <MudIconButton Icon="@Icons.Custom.Brands.GitHub" Color="Color.Inherit"/>
        Miethai Dashboard
    </MudAppBar>
    <MudMainContent Style="padding: 0;">
        @if (_isLoadingJson)
        {
            <LoadingSpinner/>
        }
        else
        {
            @Body
        }
    </MudMainContent>
</MudLayout>

@code{

    [Inject]
    public DataStatefulRepository StatefulRepository { get; set; }

    private bool _isLoadingJson = true;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await StatefulRepository.Init();
            _isLoadingJson = false;
            StateHasChanged();
        }
    }
}